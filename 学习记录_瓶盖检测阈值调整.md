# 学习记录：瓶盖检测阈值调整

## 问题描述
- 4K 木纹图识别正常，白色背景图漏检。

## 原子诊断
- 高亮背景压缩了 RGB 差值，阈值 `33` 太高。

## 解决方案
- 下调阈值至 `31`，配套加大的面积过滤。

## 新增复盘（HSV 方案）
- 现象：同一套参数在两张图上分别出现漏检/过检，单点调参无法长期稳定。
- 关键定位：通过阶段日志确认分叉点主要在 `watershed` 分割与最终 `area/circularity` 筛选，而非仅 HSV 提取。
- 结论：问题核心是“规则算法对现场分布变化敏感”，不是简单的 C++ 语法问题。

## 工程化结论
- 不是白费：已完成类封装、异常处理、内存清理、运行时参数化、逐步诊断日志。
- 根因层级：
- 1) 现场光照/反光/曝光波动导致分布漂移。
- 2) 静态阈值难覆盖全部样本。
- 3) 缺少配方化与回归测试闭环。

## 后续策略
- 固化采集条件（光源、曝光、白平衡、工位）优先于继续盲调阈值。
- 建立多配方参数（如白底/木纹），运行时选择，不使用全局单参数。
- 建立小型标注回归集，改参后批量验证漏检率与过检率。
